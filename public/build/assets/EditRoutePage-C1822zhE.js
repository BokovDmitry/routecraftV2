import{r as i,j as e,b as L}from"./app-BiCOU7zL.js";import{N as S}from"./Navbar-BTtg9IJE.js";import{C as _,R as j,a as p,F as A}from"./Row-CJlQkx92.js";import{i as G,a as R,b as U}from"./remove-ICyhTtfO.js";import{B as h}from"./CreateRoute-C_ackeyB.js";import{F as r}from"./Form-DsetpyLx.js";/* empty css                 */function O({existingRoute:l}){const[c,x]=i.useState({title:l.title||"",destination_country:l.destination_country||"",destination_city:l.destination_city||"",description:l.description||"",budget:l.budget||"",days:l.days||""}),[y,g]=i.useState(null),[b,N]=i.useState(l.image?`/storage/${l.image}`:null),[f,C]=i.useState(null),[n,d]=i.useState([]);i.useEffect(()=>{if(Array.isArray(l.stops)){console.log("Existing stops:",l.stops);const s=l.stops.map(a=>({places:Array.isArray(a)?[...a.filter(t=>t.trim()!==""),""]:[""],error:""}));console.log("Stops with inputs:",s),d(s)}},[l.stops]),i.useEffect(()=>{x(s=>({...s,days:n.length}))},[n]);const D=s=>{s.target.files&&s.target.files[0]&&(C(s.target.files[0]),N(URL.createObjectURL(s.target.files[0])))},m=s=>{const{name:a,value:t}=s.target;x({...c,[a]:t})},w=async s=>{s.preventDefault();const a=new FormData;for(let t in c)a.append(t,c[t]);n.forEach((t,o)=>{t.places.filter(u=>u.trim()!=="").forEach(u=>{a.append(`stops[${o}][]`,u)})}),f&&a.append("image",f);try{const t=await L.post(`/routes/${l.id}/update`,a,{headers:{"Content-Type":"multipart/form-data"}});alert("Route updated successfully!"),window.location.href="/my-routes"}catch(t){t.response&&t.response.status===422?(console.error("Validation errors:",t.response.data.errors),alert("Validation failed. Please check your input.")):(alert("Failed to update route."),console.error(t))}},F=(s,a,t)=>{const o=[...n];o[s].places[a]=t,t.trim()!==""&&(o[s].error=""),d(o)},E=s=>{const a=[...n];a[s].places[a[s].places.length-1].trim()!==""?a[s].places.push(""):a[s].error="Please enter a place before adding another.",d(a)},P=(s,a)=>{const t=[...n];t[s].places.splice(a,1),d(t)},k=s=>{const a=[...n];a.splice(s,1),d(a)},v=()=>{d([...n,{places:[""],error:""}])};return e.jsx("section",{className:"create-route-section py-5",children:e.jsxs(_,{children:[e.jsx("h2",{className:"text-center mb-4 section-title",children:"Edit Route"}),e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Route Image"}),e.jsxs("div",{className:"custom-file-upload-wrapper",children:[e.jsx("input",{type:"file",accept:"image/*",id:"routeImage",onChange:D,className:"d-none"}),e.jsx("label",{htmlFor:"routeImage",className:"btn btn-upload-custom",children:"Upload Image"})]}),b&&e.jsx("div",{className:"upload-preview mt-3",children:e.jsx("img",{src:b,alt:"Route Preview"})})]}),e.jsxs(r,{onSubmit:w,className:"route-form",children:[e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Route Title"}),e.jsx(r.Control,{type:"text",name:"title",value:c.title,onChange:m})]}),e.jsxs(j,{className:"mb-4",children:[e.jsx(p,{md:6,children:e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Country"}),e.jsx(r.Control,{type:"text",name:"destination_country",value:c.destination_country,onChange:m})]})}),e.jsx(p,{md:6,children:e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"City"}),e.jsx(r.Control,{type:"text",name:"destination_city",value:c.destination_city,onChange:m})]})})]}),e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Description"}),e.jsx(r.Control,{as:"textarea",name:"description",rows:4,value:c.description,onChange:m})]}),e.jsxs(j,{className:"mb-4",children:[e.jsx(p,{md:6,children:e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Budget (â‚¬)"}),e.jsx(r.Control,{type:"number",name:"budget",value:c.budget,onChange:m,min:"0",required:!0})]})}),e.jsx(p,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Days"}),e.jsx(r.Control,{type:"number",name:"days",value:c.days,onChange:m,readOnly:!0})]})})]}),e.jsxs("div",{className:"day-cards-wrapper",children:[n.length===0&&e.jsx("div",{className:"text-center mb-4",children:e.jsx(h,{variant:"dark",size:"sm",onClick:v,children:"Add Day"})}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"Daily Plan"}),e.jsx(h,{variant:"dark",size:"sm",onClick:v,children:"Add Day"})]}),e.jsx(j,{children:n.map((s,a)=>e.jsx(p,{md:4,className:"mb-4",children:e.jsxs("div",{className:"day-card p-3",children:[e.jsxs("h5",{className:"text-center mb-3",children:["Day ",a+1]}),e.jsxs("div",{className:"places-input-group mb-2",children:[e.jsx(r.Control,{type:"text",value:s.places[s.places.length-1]||"",onChange:t=>F(a,s.places.length-1,t.target.value)}),e.jsx("button",{className:"add-btn-img",type:"button",onClick:()=>E(a),onMouseEnter:()=>g(a),onMouseLeave:()=>g(null),children:e.jsx("img",{src:y===a?G:R,alt:"Add",className:"add-icon"})})]}),e.jsx("div",{className:"error-text",children:s.error||" "}),e.jsx("div",{className:"added-places mt-3",children:s.places.filter((t,o)=>o!==s.places.length-1&&t.trim()!=="").map((t,o)=>e.jsxs("div",{className:"place-tag",children:[t,e.jsx("button",{className:"remove-btn-img",onClick:()=>P(a,o),children:e.jsx("img",{src:U,alt:"Remove",className:"remove-icon"})})]},o))}),e.jsx("div",{className:"text-end mt-3",children:e.jsx(h,{variant:"outline-danger",size:"sm",onClick:()=>k(a),children:"Delete Day"})})]})},a))})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(h,{variant:"success",type:"submit",className:"px-5",children:"Update Route"})})]})]})})}const T="/build/assets/bg24-IdO12RaO.jpg";function W({route:l}){return e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsxs("div",{className:"edit-route-hero",style:{backgroundImage:`url(${T})`},children:[e.jsx("div",{className:"my-routes-hero-overlay"}),e.jsxs("div",{className:"hero-content edit-hero-content px-3",children:[e.jsx("h1",{className:"hero-title py-2",children:"EDIT YOUR ROUTE"}),e.jsx("p",{className:"hero-description py-1",children:"Update your destination, days, or must-see places."})]})]}),e.jsx(O,{existingRoute:l}),e.jsx(A,{})]})}export{W as default};
