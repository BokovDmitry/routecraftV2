import{r as m,j as e,b as L}from"./app-B--xmqr1.js";import{N as k}from"./Navbar-izyo38WX.js";import{C as _,R as h,a as p,F as G}from"./Row-SUdHJtF2.js";import{i as R,a as U,b as A}from"./remove-ICyhTtfO.js";import{B as j}from"./CreateRoute-BUq7zXIM.js";import{F as r}from"./Form-uPCzgeHV.js";/* empty css                 */function O({existingRoute:l}){const[n,f]=m.useState({title:l.title||"",destination_country:l.destination_country||"",destination_city:l.destination_city||"",description:l.description||"",budget:l.budget||"",days:l.days||""}),[v,x]=m.useState(null),[g,y]=m.useState(l.image?`/storage/${l.image}`:null),[b,N]=m.useState(null),[c,i]=m.useState([]);m.useEffect(()=>{if(Array.isArray(l.stops)){console.log("Existing stops:",l.stops);const a=l.stops.map(s=>({places:Array.isArray(s)?[...s.filter(t=>t.trim()!==""),""]:[""],error:""}));console.log("Stops with inputs:",a),i(a)}},[l.stops]);const C=a=>{a.target.files&&a.target.files[0]&&(N(a.target.files[0]),y(URL.createObjectURL(a.target.files[0])))},d=a=>{const{name:s,value:t}=a.target;f({...n,[s]:t})},D=async a=>{a.preventDefault();const s=new FormData;for(let t in n)s.append(t,n[t]);c.forEach((t,o)=>{t.places.filter(u=>u.trim()!=="").forEach(u=>{s.append(`stops[${o}][]`,u)})}),b&&s.append("image",b);try{const t=await L.post(`/routes/${l.id}/update`,s,{headers:{"Content-Type":"multipart/form-data"}});alert("Route updated successfully!"),window.location.href="/my-routes"}catch(t){t.response&&t.response.status===422?(console.error("Validation errors:",t.response.data.errors),alert("Validation failed. Please check your input.")):(alert("Failed to update route."),console.error(t))}},w=(a,s,t)=>{const o=[...c];o[a].places[s]=t,t.trim()!==""&&(o[a].error=""),i(o)},F=a=>{const s=[...c];s[a].places[s[a].places.length-1].trim()!==""?s[a].places.push(""):s[a].error="Please enter a place before adding another.",i(s)},E=(a,s)=>{const t=[...c];t[a].places.splice(s,1),i(t)},P=a=>{const s=[...c];s.splice(a,1),i(s)},S=()=>{i([...c,{places:[""],error:""}])};return e.jsx("section",{className:"create-route-section py-5",children:e.jsxs(_,{children:[e.jsx("h2",{className:"text-center mb-4 section-title",children:"Edit Route"}),e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Route Image"}),e.jsxs("div",{className:"custom-file-upload-wrapper",children:[e.jsx("input",{type:"file",accept:"image/*",id:"routeImage",onChange:C,className:"d-none"}),e.jsx("label",{htmlFor:"routeImage",className:"btn btn-upload-custom",children:"Upload Image"})]}),g&&e.jsx("div",{className:"upload-preview mt-3",children:e.jsx("img",{src:g,alt:"Route Preview"})})]}),e.jsxs(r,{onSubmit:D,className:"route-form",children:[e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Route Title"}),e.jsx(r.Control,{type:"text",name:"title",value:n.title,onChange:d})]}),e.jsxs(h,{className:"mb-4",children:[e.jsx(p,{md:6,children:e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Country"}),e.jsx(r.Control,{type:"text",name:"destination_country",value:n.destination_country,onChange:d})]})}),e.jsx(p,{md:6,children:e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"City"}),e.jsx(r.Control,{type:"text",name:"destination_city",value:n.destination_city,onChange:d})]})})]}),e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Description"}),e.jsx(r.Control,{as:"textarea",name:"description",rows:4,value:n.description,onChange:d})]}),e.jsxs(h,{className:"mb-4",children:[e.jsx(p,{md:6,children:e.jsxs(r.Group,{className:"mb-4",children:[e.jsx(r.Label,{children:"Budget (â‚¬)"}),e.jsx(r.Control,{type:"number",name:"budget",value:n.budget,onChange:d,min:"0",required:!0})]})}),e.jsx(p,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Days"}),e.jsx(r.Control,{type:"number",name:"days",value:n.days,onChange:d,readOnly:!0})]})})]}),e.jsxs("div",{className:"day-cards-wrapper",children:[console.log("Stops:",c.length),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"Daily Plan"}),e.jsx(j,{variant:"dark",size:"sm",onClick:S,children:"Add Day"})]}),e.jsx(h,{children:c.map((a,s)=>e.jsx(p,{md:4,className:"mb-4",children:e.jsxs("div",{className:"day-card p-3",children:[e.jsxs("h5",{className:"text-center mb-3",children:["Day ",s+1]}),e.jsxs("div",{className:"places-input-group mb-2",children:[e.jsx(r.Control,{type:"text",value:a.places[a.places.length-1]||"",onChange:t=>w(s,a.places.length-1,t.target.value)}),e.jsx("button",{className:"add-btn-img",type:"button",onClick:()=>F(s),onMouseEnter:()=>x(s),onMouseLeave:()=>x(null),children:e.jsx("img",{src:v===s?R:U,alt:"Add",className:"add-icon"})})]}),e.jsx("div",{className:"error-text",children:a.error||" "}),e.jsx("div",{className:"added-places mt-3",children:a.places.filter((t,o)=>o!==a.places.length-1&&t.trim()!=="").map((t,o)=>e.jsxs("div",{className:"place-tag",children:[t,e.jsx("button",{className:"remove-btn-img",onClick:()=>E(s,o),children:e.jsx("img",{src:A,alt:"Remove",className:"remove-icon"})})]},o))}),e.jsx("div",{className:"text-end mt-3",children:e.jsx(j,{variant:"outline-danger",size:"sm",onClick:()=>P(s),children:"Delete Day"})})]})},s))})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(j,{variant:"success",type:"submit",className:"px-5",children:"Update Route"})})]})]})})}const T="/build/assets/bg24-IdO12RaO.jpg";function W({route:l}){return e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsxs("div",{className:"edit-route-hero",style:{backgroundImage:`url(${T})`},children:[e.jsx("div",{className:"my-routes-hero-overlay"}),e.jsxs("div",{className:"hero-content edit-hero-content px-3",children:[e.jsx("h1",{className:"hero-title py-2",children:"EDIT YOUR ROUTE"}),e.jsx("p",{className:"hero-description py-1",children:"Update your destination, days, or must-see places."})]})]}),e.jsx(O,{existingRoute:l}),e.jsx(G,{})]})}export{W as default};
